<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Application de Messagerie</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@emoji-mart/css@latest/css/emoji-mart.css">

    <link rel="stylesheet" href="../CSS/style index.css">

    <link rel="manifest" href="../manifest.json">

    <script src="https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@4.6.2/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emoji-mart/data@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emoji-mart/js@latest"></script>
    
</head>

<body>
    <aside class="sidebar">

        <!-- En-tête de la barre latérale --> 

        <header class="sidebar-header">
            <a href="#" class="header-logo">
                <img src="https://via.placeholder.com/46" alt="Logo de l'application">
            </a>
            <button class="toggler sidebar-toggler" aria-label="Réduire le menu">
                <i class='bx bx-chevron-left'></i>
            </button>
            <button class="toggler menu-toggler" aria-label="Ouvrir/fermer le menu">
                <span class="material-symbols-rounded">menu</span>
            </button>
        </header>

        <nav class="sidebar-nav">  

            <!-- Navigation principale -->

            <ul class="nav-list primary-nav">

                <li class="nav-item">
                    <a href="#" class="nav-link" aria-label="Conversations">
                        <i class='bx bx-chat'></i>
                        <span class="nav-label">Conversations</span>
                    </a>
                    <span class="nav-tooltip">Conversations</span>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" aria-label="story">
                        
                        <span class="nav-label">Story</span>
                    </a>
                    <span class="nav-tooltip">Notifications</span>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" aria-label="Équipes">
                        <i class='bx bx-group'></i>
                        <span class="nav-label">Équipes</span>
                    </a>
                    <span class="nav-tooltip">Équipes</span>
                </li>
                
                <li class="nav-item">
                    <a href="../HTML/journal d'appel.html" class="nav-link" aria-label="Appels">
                        <i class='bx bx-phone-call'></i>
                        <span class="nav-label">Appels</span>
                    </a>
                    <span class="nav-tooltip">Appels</span>
                </li>
                <li class="nav-item">
                    <a href="../HTML/parametre.html" class="nav-link" aria-label="Paramètres">
                        <i class='bx bx-cog'></i>
                        <span class="nav-label">Paramètres</span>
                    </a>
                    <span class="nav-tooltip">Paramètres</span>
                </li>
            </ul>


            <!-- Navigation secondaire -->

            <ul class="nav-list secondary-nav">
                <li class="nav-item">
                    <a href="../HTML/Profile.html" class="nav-link" aria-label="Profil">
                        <i class='bx bx-user'></i>
                        <span class="nav-label">Profil</span>
                    </a>
                    <span class="nav-tooltip">Profil</span>
                </li>
                <li class="nav-item">
                    <a href="../HTML/page connexion.html" class="nav-link" aria-label="Déconnexion">
                        <i class='bx bx-log-out'></i>
                        <span class="nav-label">Déconnexion</span>
                    </a>
                    <span class="nav-tooltip">Déconnexion</span>
                </li>
            </ul>

        </nav>

    </aside>

    <!-- Liste des Disucssions -->

    <main class="chat-container">
        <div class="discussions-list">
            <div class="discussions-header">
                <div class="search-discussions">
                    <div class="search-wrapper">
                        <i class="bx bx-search"></i>
                        <div class="search-fliters">
                            <button class="fliter-btn" data-filter="Messages">Messages</button>
                            <button class="fliter-btn" data-filter="Files">Fichiers</button>
                            <button class="fliter-btn" data-filter="Links">Liens</button>
                        </div>
                    </div>
                    <div class="advanced-search">
                        <div class="search-filters">
                            <select class="date-filter">
                                <option value="">Toutes les dates</option>
                                <option value="today">Aujourd'hui</option>
                                <option value="week">Cette semaine</option>
                                <option value="month">Ce mois</option>
                            </select>
                            <select class="type-filter">
                                <option value="">Tous les types</option>
                                <option value="text">Texte</option>
                                <option value="media">Médias</option>
                                <option value="files">Fichiers</option>
                                <option value="links">Liens</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="new-chat-btn">
                        <i class='bx bx-plus'></i>
                    </button>
                </div>   
            </div>

            <div class="dicusssions">
                <div class="chat-item">
                    <div class="chat-avatar">
                        <img src="https://via.placeholder.com/50" alt="">
                        <span class="status-dot online"></span>
                    </div>
                    <div class="chat-info">
                        <h3>Nom de l'utilisateur</h3>
                        <p class="last-message">Dernier message...</p>
                    </div>
                    <div class="chat-meta">
                        <span class="time">10:30</span>
                        <span class="unread-count">3</span>
                        <button class="delete-chat-btn" title="Supprimer la conversation">
                            <i class='bx bx-trash'></i>
                        </button>
                    </div>
                </div>
                <div class="chat-item">
                    <div class="chat-avatar">
                        <img src="https://via.placeholder.com/50" alt="">
                        <span class="status-dot offline"></span>
                    </div>
                    <div class="chat-info">
                        <h3>Nom de l'utilisateur</h3>
                        <p class="last-message">Dernier message...</p>
                    </div>
                    <div class="chat-meta">
                        <span class="time">10:30</span>
                        <span class="unread-count">3</span>
                        <button class="delete-chat-btn" title="Supprimer la conversation">
                            <i class='bx bx-trash'></i>
                        </button>
                    </div>
                </div>

                <div class="chat-item">
                    <div class="chat-avatar">
                        <img src="https://via.placeholder.com/50" alt="">
                        <span class="status-dot offline"></span>
                    </div>
                    <div class="chat-info">
                        <h3>Nom de l'utilisateur</h3>
                        <p class="last-message">Dernier message...</p>
                    </div>
                    <div class="chat-meta">
                        <span class="time">10:30</span>
                        <span class="unread-count">3</span>
                        <button class="delete-chat-btn" title="Supprimer la conversation">
                            <i class='bx bx-trash'></i>
                        </button>
                    </div>
                </div>

                <div class="chat-item">
                    <div class="chat-avatar">
                        <img src="https://via.placeholder.com/50" alt="">
                        <span class="status-dot offline"></span>
                    </div>
                    <div class="chat-info">
                        <h3>Nom de l'utilisateur</h3>
                        <p class="last-message">Dernier message...</p>
                    </div>
                    <div class="chat-meta">
                        <span class="time">10:30</span>
                        <span class="unread-count">3</span>
                        <button class="delete-chat-btn" title="Supprimer la conversation">
                            <i class='bx bx-trash'></i>
                        </button>
                    </div>
                </div>

                <div class="chat-item">
                    <div class="chat-avatar">
                        <img src="https://via.placeholder.com/50" alt="">
                        <span class="status-dot offline"></span>
                    </div>
                    <div class="chat-info">
                        <h3>Nom de l'utilisateur</h3>
                        <p class="last-message">Dernier message...</p>
                    </div>
                    <div class="chat-meta">
                        <span class="time">10:30</span>
                        <span class="unread-count">3</span>
                        <button class="delete-chat-btn" title="Supprimer la conversation">
                            <i class='bx bx-trash'></i>
                        </button>
                    </div>
                </div>

                <div class="chat-item">
                    <div class="chat-avatar">
                        <img src="https://via.placeholder.com/50" alt="">
                        <span class="status-dot offline"></span>
                    </div>
                    <div class="chat-info">
                        <h3>Nom de l'utilisateur</h3>
                        <p class="last-message">Dernier message...</p>
                    </div>
                    <div class="chat-meta">
                        <span class="time">10:30</span>
                        <span class="unread-count">3</span>
                        <button class="delete-chat-btn" title="Supprimer la conversation">
                            <i class='bx bx-trash'></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
  

    <!-- Fenêtre de discussion -->

     <div class="chat-box">
        <div class="chat-header">
            <div class="chat-user-info">
                <img src="https://via.placeholder.com/50" alt="">
                <div class="user-details">
                    <h3>Nom du contact</h3>
                    <span class="status">Enligne</span>
                    <span class="typing-indicator" style="display: none">est en train d'écrire...</span>
                </div>
            </div>
            <div class="chat-actions" style="margin-left: auto;">
                <button class="action-btn"><i class="bx bx-phone"></i></button>
                <button class="action-btn"><i class="bx bx-video"></i></button>
                <button class="action-btn lock-chat-btn"><i class="bx bx-lock-alt"></i></button>
                <button class="action-btn start-group-call" title="Démarrer appel video en groupe"><i class="bx bx-video-plus"></i></button>
                <button class="action-btn info-btn"><i class="bx bx-info-circle"></i></button>
                <div class="info-dropdown">
                    <ul>
                        <li> Voir le profile</li>
                        <li> Recherche</li>
                        <li> Media et Liens</li>
                        <li> Mode Silencieux</li>
                        <li> Messages éphémeres</li>
                        <li class="notes-btn"> Notes personnelles <i class="bx bx-note"></i></li>
                        <li class="archive-chat"><i class="bx bx-archive"></i>Archiver la conversation</li>
                        <li class="export-chat"><i class="bx bx-export"></i>Exporter la conversation</li>
                        <li> Plus <i class="bx bx-chevron-right"></i></li>
                    </ul>
                </div>
            </div>

            <div class="notes-panel" style="display: none;">
                <div class="notes-header">
                    <h3>Notes personnelles</h3>
                    <button class="close-notes"><i class="bx bx-x"></i></button>
                </div>
                <div class="notes-content">
                    <textarea placeholder="Écrire une note..."></textarea>
                </div>
                <div class="notes-footer">
                    <button class="save-notes">Enregistrer</button>
                </div>
            </div>

            <div class="media-gallery" style="display: none;">
                <div class="gallery-header">
                    <h3>Médias partagés</h3>
                    <div class="gallery-tabs">
                        <button class="tab-btn active" data-type="all"></button>
                        <button class="tab-btn" data-type="images"></button>
                        <button class="tab-btn" data-type="videos"></button>
                        <button class="tab-btn" data-type="files"></button>
                    </div>
                    <button class="close-gallery">
                        <i class="bx bx-x"></i>
                    </button>
                </div>
                <div class="gallery-content">
                    <div class="media-grid">
                        <!--Les medias seront ajoutés ici dynamiquement -->
                    </div>
                </div>
            </div>

            <div class="chat-input"> 
                <div class="reply-preview" style="display: none;">
                    <span class="reply-to-text"></span>
                    <button class="cancel-reply">
                        <i class="bx bx-x"></i>
                    </button>
                    <div class="mentions-list" style="display: none;">
                        <ul>
                            <!-- Cette liste sera remplie dynamiquement -->
                        </ul>
                    </div>
                </div>
                <button class="attachement-btn" aria-label="Joindre un fichier">
                    <i class="bx bx-paperclip"></i>
                </button>
                <input type="file" id="file-input" style="display: none" multiple>
                <input type="text" placeholder="Écrire un message...">
                <input type="file" id="file-input" style="display: none" multiple>
                <div class="upload-progress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div class="progress-text">0%</div>
                </div>
                <button class="emoji-btn" title=" Inserer un emoji">
                    <i class="bx bx-smile"></i>
                </button>
                <div class="emoji-picker"></div>  
                <button class="send-btn mic-btn" title="Enregistrer un message vocal">
                    <i class="bx bx-microphone"></i>
                </button>
                <button class="send-btn send-message-btn" style="display: none;" title="Envoyer le message">
                    <i class="bx bx-send"></i>
                </button>               
                <canvas id="visualizer" style="display: none; height: 40px; width: 100%;"></canvas>
                <div class="file-preview-container" style="display: none;">
                    <div class="file-preview-header">
                        <h4>Fichiers à envoyer</h4>
                        <button class="clear-files"><i class='bx bx-x'></i></button>
                    </div>
                    <div class="file-preview-list">
                        <!-- Liste des fichiers -->
                    </div>
                    <div class="file-actions">
                        <button class="compress-files">Compresser</button>
                        <button class="send-files">Envoyer</button>
                    </div>
                </div>
            </div>

            <div class="search-messages" style="display: none;">
                <div class="search-container">
                    <input type="text" id="message-search" placeholder="Rechercher dans les messages...">
                    <button class="close-search">
                        <i class="bx bx-x"></i>
                    </button>
                </div>
                <div class="search results">
                    <div class="results-count"></div>
                    <div class="results-list"></div>
                    <div class="navigation-button">
                        <button class="prev-result" disabled>
                            <i class="bx bx-up-arrow-alt"></i>
                        </button>
                        <button class="next-result" disabled>
                            <i class="bx bx-down-arrow-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="pinned-message">
            <h4>Message épinglés</h4>
            <div class="pinned-message-list">
                <!-- Les messages épinglés seront ajoutés ici dynamiquement -->
            </div>
        </div>

        <div class="chat-messages">
            <div class="message sent">
                <p>Bonjour ! Comment ça va ?</p>
                <div class="message-footer">
                        <span class="time">10:30</span>
                        <span class="message-status">
                            <i class="bx bx-check-double"></i>
                        </span>
                </div>
                <div class="message-actions">
                    <button class="pin-btn" title="Epingler le message">
                        <i class="bx bx-pin"></i>
                    </button>
                    <button class="reply-btn" title="Répondre">
                        <i class="bx bx-reply"></i>
                    </button>
                    <button class="edit-btn" title="Modifier">
                        i<i class="bx bx-edit"></i>
                    </button>
                    <button class="forward-btn" title="Transférer">
                        <i class="bx bx-share"></i>
                    </button>
                    <button class="favorite-btn" title="Marquer comme favori">
                        <i class="bx bx-star"></i>
                    </button>
                    <button class="save-message-btn" title="Sauvegarder pour plus tard">
                        <i class="bx bx-bookmark"></i>
                    </button>
                    <div class="message-translation">
                        <button class="translate-btn" title="Traduire le message">
                            <i class="bx bx-translate"></i>
                        </button>
                        <div class="translation-content" style="display: none;"></div>

                        <button class="reminder-btn" title="Me le rappeler plus tard">
                            <i class="bx bx-time"></i>
                        </button>
                        <button class="quote-btn">
                            <i class="bx bx-quote-right"></i>
                        </button>
                        <div class="reminder-popup" style="display: none;">
                            <h4>Rappel</h4>
                            <select class="reminder-time">
                                <option value="1h">Dans 1 heure</option>
                                <option value="2h">Dans 2 heures</option>
                                <option value="1d">Demain</option>
                                <option value="1w">Dans une semaine</option>
                                <option value="custom">Personnalisé</option>
                            </select>
                            <input type="datetime-local" class="custom-reminder-time" style="display: none;">
                            <div class="reminder-repeat">
                                <label>
                                    <input type="checkbox" class="reapeat-reminder">
                                    Repeter 
                                </label>
                                <select class="repeat-interval" disabled>
                                    <option value="daily">Chaque jour</option>
                                    <option value="weekly">Chaque semaine</option>
                                    <option value="monthly">Chaque mois</option>
                                </select>
                            </div>
                        </div>
                        <button class="set-reminder-btn">Defiinir le rappel </button>
                    </div>
                </div>
                <button class="delete-btn">
                    <i class="bx bx-trash"></i>
                </button>
            </div>
            <div class="message received">
                <p>Salut ! Ça va bien, merci. Et toi ?</p>
                <span class="time">10:31</span>
            </div>
            <div class="message-thread">
                <button class="show-thread-btn">
                    <i class="bx bx-git-branch"></i>
                    <span>Voir le fil de disucssion (3)</span>
                </button>
                <div class="thread-message" style="display: none;"></div>
            </div>
            <div class="message sent">
                <p>Je vais bien aussi, merci !</p>
                <span class="time">10:32</span>
            </div>
            <div class="message received">
                <p>Super ! As-tu des nouvelles de notre projet ?</p>
                <span class="time">10:33</span>
            </div>
            <div class="message-thread">
                <button class="show-thread-btn">
                    <i class="bx bx-git-branch"></i>
                    <span>Voir le fil de disucssion (3)</span>
                </button>
            </div>
            <div class="link-preview">
                <img src="" alt="apercu du lien" class="preview-image">
                <div class="preview-content">
                    <h4 class="preview-title"></h4>
                    <p class="preview-description"></p>
                    <span class="preview-url"></span>
                </div>
            </div>
        </div>
        <div class="message sent poll-message">
            <div class="poll-container">
                <h4 class="poll-question">Quel jour pour la reunion ?</h4>
                <div class="poll-options">
                    <div class="poll-option">
                        <div class="option-header">
                            <input type="radio" name="poll" id="option1">
                            <label for="option1">Lundi 14h</label>
                            <span class="vote-count">3 votes</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: 60%;"></div>
                        </div>
                    </div>
                    <div class="poll-option">
                        <div class="option-header">
                            <input type="radio" name="poll" id="option2">
                            <label for="option2">Mardi 10h</label>
                            <span class="vote-count">2 votes</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: 40%;"></div>
                        </div>
                    </div>
                </div>
                <div class="poll-footer">
                    <span class="total-votes">Total votes: 5</span>
                    <button class="end-poll-btn">Terminer le sondage</button>
                </div>
            </div>
            <div class="message-footer">
                <span class="time">10:30</span>
                <div class="read-status">
                    <span class="read-by">Lus par 3 personnes</span>
                    <div class="read-avatars">
                        <!-- Les avatars des lecteurs seront ajoutés dynamiquement -->
                    </div>
                </div>
            </div>
        </div>

        
    <div class="video-call-container">
    <div class="video-grid">
        <!-- Les vidéos seront ajoutées ici dynamiquement -->
    </div>
    <div class="call-controls">
        <button class="call-control-btn toggle-audio" title="Couper/Activer le micro">
            <i class="bx bx-microphone"></i>
        </button>
        <button class="call-control-btn toggle-video" title="Couper/Activer la vidéo">
            <i class="bx bx-video"></i>
        </button>
        <button class="call-control-btn share-screen" title="Partager l'écran">
            <i class="bx bx-desktop"></i>
        </button>
        <button class="call-control-btn end-call" title="Terminer l'appel">
            <i class="bx bx-phone-off"></i>
        </button>
    </div>
</div>

</div>

<script src="../JS/script index.js"></script>
<script src="../JS/emoji.js"></script>
<script src="../JS/attachements.js"></script>
<script src="../JS/voice.js"></script>
<script src="../JS/edit-message.js"></script>
<script src="../JS/audio-visualiser.js"></script>
<script src="../JS/reply.js"></script>
<script src="../JS/message-status.js"></script>
<script src="../JS/upload-progress.js"></script>
<script src="../JS/forward.js"></script>
<script src="../JS/mentions.js"></script>
<script src="../JS/self-destruct.js"></script>
<script src="../JS/pinned-message.js"></script>
<script src="../JS/typing-indicator.js"></script>
<script src="../JS/link-preview.js"></script>
<script src="../JS/polls.js"></script>
<script src="../JS/chat-lock.js"></script>
<script src="../JS/search.js"></script>
<script src="../JS/media-gallery.js"></script>
<script src="../JS/mobile-navigation.js"></script>
<script src="../JS/video-call.js"></script>
<script src="../JS/info-dropdown.js"></script>
<script src="../JS/features.js"></script>
<script src="../JS/delete-chat.js"></script>

<script>
    const API_URL = "http://localhost:3000/api/settings";

    // Fonction pour récupérer les paramètres
    async function loadSettings() {
        try {
            const response = await fetch(API_URL);
            const settings = await response.json();
            console.log("Paramètres chargés :", settings);

            // Appliquer les paramètres
            document.body.classList.toggle("dark-mode", settings.darkMode);
            document.documentElement.style.setProperty("--font-size", `${settings.fontSize}rem`);
        } catch (error) {
            console.error("Erreur lors du chargement des paramètres :", error);
        }
    }

    // Charger les paramètres au chargement de la page
    window.addEventListener("DOMContentLoaded", loadSettings);
</script>

</body>
</html>